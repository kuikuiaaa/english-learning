<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>è‹±è¯­å­¦ä¹ åŠ©æ‰‹ Proï¼ˆCET-4 å®Œæ•´è¯åº“ï¼‰</title>
<style>
  body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0; text-align:center; }
  header { background:#4CAF50; color:#fff; padding:15px; font-size:20px; }
  .container { max-width:900px; margin:0 auto; padding:16px; }
  .status { font-size:14px; color:#555; margin:8px 0 16px; }
  .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:16px; }
  .card { background:#fff; padding:18px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,.08); cursor:pointer; white-space:pre-line; }
  .card h2 { margin:0 0 8px; font-size:18px; }
  .big { font-size:22px; }
  button { background:#4CAF50; color:#fff; border:0; padding:10px 16px; border-radius:8px; font-size:15px; cursor:pointer; margin:6px; }
  button:hover { background:#45a049; }
  input, .pill { padding:10px 12px; border:1px solid #ddd; border-radius:8px; font-size:14px; }
  .row { margin:12px 0; }
  .pill { display:inline-block; background:#fff; }
  .muted { color:#777; font-size:13px; }
</style>
</head>
<body>
  <header>ğŸ“š è‹±è¯­å­¦ä¹ åŠ©æ‰‹ Proï¼ˆCET-4 å®Œæ•´è¯åº“ï¼‰</header>
  <div class="container">
    <div class="status" id="loadStatus">æ­£åœ¨åŠ è½½å››çº§è¯åº“â€¦â€¦</div>

    <div class="row">
      <span class="pill">å·²åŠ è½½è¯æ•°ï¼š<b id="wordCount">0</b></span>
      <span class="pill">å»é‡åï¼š<b id="uniqueCount">0</b></span>
      <button id="downloadBtn" title="å¯¼å‡ºä¸º JSON æ–‡ä»¶">ä¸‹è½½è¯åº“ JSON</button>
    </div>

    <div class="row">
      <input id="searchInput" placeholder="æœç´¢è‹±æ–‡æˆ–ä¸­æ–‡é‡Šä¹‰ï¼ˆå®æ—¶è¿‡æ»¤ï¼‰" />
      <button id="resetSearch">æ¸…é™¤æœç´¢</button>
    </div>

    <div class="grid">
      <!-- å•è¯å¡ç‰‡ -->
      <div class="card" id="wordCardWrap">
        <h2>å•è¯å¡ç‰‡</h2>
        <div class="big" id="wordCard">ç‚¹å‡»æ˜¾ç¤ºä¸­æ–‡é‡Šä¹‰</div>
        <div class="row">
          <button id="nextWordBtn">ä¸‹ä¸€ä¸ªå•è¯</button>
          <button id="speakWordBtn">ğŸ”Š æœ—è¯»</button>
        </div>
        <div class="muted">ç‚¹å¡ç‰‡åœ¨è‹±æ–‡/ä¸­æ–‡é—´åˆ‡æ¢</div>
      </div>

      <!-- æ¯æ—¥ä¸€å¥ï¼ˆç¤ºä¾‹å›ºå®šï¼‰ -->
      <div class="card">
        <h2>æ¯æ—¥ä¸€å¥</h2>
        <div class="big" id="dailySentence">ç‚¹å‡»è·å–å¥å­</div>
        <div class="row">
          <button id="showSentenceBtn">è·å–ä¸€å¥</button>
          <button id="speakSentenceBtn">ğŸ”Š æœ—è¯»</button>
        </div>
      </div>

      <!-- æµ‹éªŒæ¨¡å¼ -->
      <div class="card">
        <h2>æµ‹éªŒæ¨¡å¼</h2>
        <div class="big" id="quizWord">ç‚¹å‡»å¼€å§‹æµ‹éªŒ</div>
        <div class="row">
          <input type="text" id="quizAnswer" placeholder="è¾“å…¥ä¸­æ–‡æ„æ€" />
        </div>
        <div class="row">
          <button id="checkAnswerBtn">æ£€æŸ¥ç­”æ¡ˆ</button>
          <button id="nextQuizBtn">ä¸‹ä¸€ä¸ªé¢˜ç›®</button>
        </div>
      </div>
    </div>

    <div class="row muted" style="margin-top:18px">
      è¯åº“æ¥æºï¼šå¼€æºå››çº§è¯è¡¨ï¼ˆå«é‡Šä¹‰ï¼‰ï¼Œé¡µé¢è‡ªåŠ¨å»é‡å¹¶åŠ è½½ã€‚
    </div>
  </div>

<script>
/** ========= è¯åº“åŠ è½½ï¼ˆå®Œæ•´å››çº§ï¼Œå«ä¸­æ–‡ï¼Œè‡ªåŠ¨å»é‡ï¼‰ =========
 * ä¸»æºï¼šGitHub åŸå§‹æ–‡ä»¶ï¼ˆraw.githubusercontent.comï¼‰
 * å¤‡æºï¼šjsDelivr CDNï¼ˆé˜²æ­¢å¶å‘è·¨åŸŸ/ç½‘ç»œé—®é¢˜ï¼‰
 * è§£æè§„åˆ™ï¼šé€è¡ŒæŒ‰åˆ¶è¡¨ç¬¦ \t åˆ‡åˆ†ï¼Œç¬¬ä¸€åˆ—è§†ä¸ºè‹±æ–‡ï¼Œå…¶ä½™åˆ—åˆå¹¶ä¸ºä¸­æ–‡é‡Šä¹‰
 */
const SOURCE_URLS = [
  // cuttlin/Vocabulary-of-CET-4 -> TXT/æ€»è¡¨/å››çº§è¯æ±‡æ€»è¡¨.txt
  "https://raw.githubusercontent.com/cuttlin/Vocabulary-of-CET-4/master/TXT/%E6%80%BB%E8%A1%A8/%E5%9B%9B%E7%BA%A7%E8%AF%8D%E6%B1%87%E6%80%BB%E8%A1%A8.txt",
  "https://cdn.jsdelivr.net/gh/cuttlin/Vocabulary-of-CET-4/TXT/%E6%80%BB%E8%A1%A8/%E5%9B%9B%E7%BA%A7%E8%AF%8D%E6%B1%87%E6%80%BB%E8%A1%A8.txt"
];

let rawLines = [];
let wordsAll = [];      // å…¨é‡ï¼ˆå«é‡å¤ã€ç©ºè¡Œæ¸…ç†å‰ï¼‰
let words = [];         // å»é‡åå¯ç”¨è¯åº“ {en, zh, score}
let filtered = null;    // æœç´¢è¿‡æ»¤
let wordIndex = 0;
let quizIndex = 0;
let showMeaning = false;
let currentWord = { en: "", zh: "", score: 0 };
let currentSentence = { en: "", zh: "" };

const $ = (id) => document.getElementById(id);

const dailySentences = [
  { en: "The best way to predict the future is to create it.", zh: "é¢„æµ‹æœªæ¥çš„æœ€å¥½æ–¹æ³•å°±æ˜¯åˆ›é€ å®ƒã€‚" },
  { en: "Practice makes perfect.", zh: "ç†Ÿèƒ½ç”Ÿå·§ã€‚" },
  { en: "Never give up on your dreams.", zh: "æ°¸è¿œä¸è¦æ”¾å¼ƒä½ çš„æ¢¦æƒ³ã€‚" }
];

function speak(text, lang = "en-US") {
  if (!text) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  speechSynthesis.speak(u);
}

async function loadCet4List() {
  const statusEl = $("loadStatus");
  for (const url of SOURCE_URLS) {
    try {
      statusEl.textContent = "æ­£åœ¨åŠ è½½è¯åº“â€¦ï¼ˆæºï¼š" + url.split("/")[2] + "ï¼‰";
      const resp = await fetch(url, { cache: "no-store" });
      if (!resp.ok) continue;
      const text = await resp.text();

      // ç»Ÿä¸€æ¢è¡Œç¬¦ï¼Œå»æ‰ BOM
      const t = text.replace(/^\uFEFF/, "").replace(/\r\n?/g, "\n");
      rawLines = t.split("\n").filter(line => line.trim().length > 0);

      // è§£ææ¯ä¸€è¡Œï¼šç¬¬ä¸€åˆ—è‹±æ–‡ï¼Œå…¶ä½™åˆ—å¹¶æˆä¸­æ–‡
      const tmp = [];
      for (const line of rawLines) {
        const cols = line.split(/\t+/);
        let en = (cols[0] || "").trim();
        let zh = cols.slice(1).join("ï¼›").trim();
        if (!en) continue;
        // æŸäº›è¡¨å¯èƒ½æŠŠé‡Šä¹‰æ”¾åˆ°å•åˆ—é‡Œï¼Œå…œåº•ä¸ºç©ºåˆ™è·³è¿‡
        if (!zh) continue;
        tmp.push({ en, zh });
      }

      $("wordCount").textContent = tmp.length;

      // å»é‡ï¼šè‹±æ–‡å°å†™å»é‡
      const seen = new Set();
      words = tmp.filter(item => {
        const key = item.en.toLowerCase();
        if (seen.has(key)) return false;
        seen.add(key);
        return true;
      }).map(x => ({ ...x, score: 0 }));

      $("uniqueCount").textContent = words.length;
      statusEl.textContent = "è¯åº“åŠ è½½å®Œæˆ âœ…";
      return; // æˆåŠŸåˆ™é€€å‡º
    } catch (e) {
      // å°è¯•ä¸‹ä¸€ä¸ªæº
    }
  }
  $("loadStatus").textContent = "âŒ è¯åº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œã€‚";
}

function pool() {
  return filtered && filtered.length ? filtered : words;
}

function nextWord() {
  const list = pool();
  if (!list.length) return;
  showMeaning = false;
  // ä½åˆ†ä¼˜å…ˆï¼ˆæ›´å¸¸å‡ºç°ï¼‰
  list.sort((a, b) => (a.score ?? 0) - (b.score ?? 0));
  currentWord = list[wordIndex % list.length];
  $("wordCard").textContent = currentWord.en;
  speak(currentWord.en);
  wordIndex++;
}

$("wordCardWrap").addEventListener("click", () => {
  if (!currentWord.en) return;
  if (showMeaning) {
    $("wordCard").textContent = currentWord.en;
  } else {
    $("wordCard").textContent = currentWord.zh;
  }
  showMeaning = !showMeaning;
});

function showSentence() {
  currentSentence = dailySentences[Math.floor(Math.random() * dailySentences.length)];
  $("dailySentence").textContent = currentSentence.en + "\n" + currentSentence.zh;
  speak(currentSentence.en);
}

// æµ‹éªŒ
function nextQuiz() {
  const list = pool();
  if (!list.length) return;
  list.sort((a, b) => (a.score ?? 0) - (b.score ?? 0));
  currentWord = list[quizIndex % list.length];
  $("quizWord").textContent = currentWord.en;
  $("quizAnswer").value = "";
  quizIndex++;
  speak(currentWord.en);
}

function checkAnswer() {
  const ans = $("quizAnswer").value.trim();
  if (!currentWord.en) return;
  if (ans && currentWord.zh.includes(ans)) {
    alert("âœ… æ­£ç¡®ï¼");
    currentWord.score = (currentWord.score ?? 0) + 1;
  } else {
    alert(`âŒ é”™è¯¯ï¼Œæ­£ç¡®ç­”æ¡ˆç¤ºä¾‹ï¼š${currentWord.zh}`);
    currentWord.score = Math.max(0, (currentWord.score ?? 0) - 1);
  }
}

// æœç´¢ï¼ˆè‹±æ–‡æˆ–ä¸­æ–‡ï¼‰
$("searchInput").addEventListener("input", (e) => {
  const q = e.target.value.trim().toLowerCase();
  if (!q) { filtered = null; return; }
  filtered = words.filter(w =>
    w.en.toLowerCase().includes(q) || (w.zh || "").toLowerCase().includes(q)
  );
  // æœç´¢æ—¶é‡ç½®ç´¢å¼•
  wordIndex = 0; quizIndex = 0;
});
$("resetSearch").addEventListener("click", () => {
  $("searchInput").value = "";
  filtered = null;
});

// å¯¼å‡º JSONï¼ˆå»é‡åçš„å®Œæ•´è¯åº“ï¼‰
$("downloadBtn").addEventListener("click", () => {
  if (!words.length) { alert("è¯åº“æœªåŠ è½½å®Œæˆ"); return; }
  const data = words.map(({en, zh}) => ({ en, zh }));
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "cet4_words.json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});

// äº‹ä»¶ç»‘å®š
$("nextWordBtn").addEventListener("click", nextWord);
$("speakWordBtn").addEventListener("click", () => speak(currentWord.en));
$("showSentenceBtn").addEventListener("click", showSentence);
$("speakSentenceBtn").addEventListener("click", () => speak(currentSentence.en));
$("checkAnswerBtn").addEventListener("click", checkAnswer);
$("nextQuizBtn").addEventListener("click", nextQuiz);

// å¯åŠ¨
(async () => {
  await loadCet4List();
  if (words.length) {
    nextWord();
  }
})();
</script>
</body>
</html>

